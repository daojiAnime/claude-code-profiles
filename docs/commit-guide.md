# Commit è§„èŒƒæ–‡æ¡£

æœ¬æ–‡æ¡£åŸºäº `pyproject.toml` ä¸­çš„ `[tool.commitizen.customize]` é…ç½®,åˆ—å‡ºé¡¹ç›®çš„ Git æäº¤è§„èŒƒ.

## æäº¤æ ¼å¼

### æ ‡å‡†æ ¼å¼

```
<emoji> <type>(<scope>): <subject>

[body]

[footer]
```

### æ ¼å¼è¯´æ˜

- **emoji**: å¯¹åº”æäº¤ç±»å‹çš„è¡¨æƒ…ç¬¦å·(å¿…å¡«)
- **type**: æäº¤ç±»å‹(å¿…å¡«)
- **scope**: ä¿®æ”¹å†…å®¹çš„èŒƒå›´(å¯é€‰)
- **subject**: ç®€è¦æè¿°(å¿…å¡«)
- **body**: è¯¦ç»†æè¿°(å¯é€‰)
- **footer**: éœ€è¦å…³é—­çš„ issue(å¯é€‰)

### Schema æ­£åˆ™

```
(ğŸ’ bump|ğŸš€ break|âœ¨ feat|ğŸ› fix|â™»ï¸ refactor|âš¡ perf|âœ… test|ğŸ”¨ build|ğŸ‘· ci)(\([a-z][a-z0-9_-]*\))?:(\s.*)
```

## æäº¤ç±»å‹åˆ—è¡¨

### 1. âœ¨ feat - æ–°åŠŸèƒ½

- **æè¿°**: æ·»åŠ æ–°åŠŸèƒ½
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: MINOR(æ¬¡ç‰ˆæœ¬å· +1)
- **ç¤ºä¾‹**:
  ```
  âœ¨ feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½
  âœ¨ feat(auth): å®ç° OAuth2 è®¤è¯
  âœ¨ feat(trade): æ–°å¢è‡ªåŠ¨äº¤æ˜“ç­–ç•¥
  ```

### 2. ğŸ› fix - Bug ä¿®å¤

- **æè¿°**: ä¿®å¤ Bug
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: PATCH(ä¿®è®¢å· +1)
- **ç¤ºä¾‹**:
  ```
  ğŸ› fix: ä¿®å¤ç™»å½•å¤±è´¥é—®é¢˜
  ğŸ› fix(session): å¤„ç†ä¼šè¯è¿‡æœŸå¼‚å¸¸
  ğŸ› fix(config): ä¿®æ­£ Redis è¿æ¥é…ç½®é”™è¯¯
  ```

### 3. â™»ï¸ refactor - ä»£ç é‡æ„

- **æè¿°**: é‡æ„ä»£ç ,ä¸ä¿®å¤ bug ä¹Ÿä¸æ·»åŠ æ–°åŠŸèƒ½
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: PATCH(ä¿®è®¢å· +1)
- **ç¤ºä¾‹**:
  ```
  â™»ï¸ refactor: ä¼˜åŒ–å¼‚æ­¥ä»»åŠ¡ç®¡ç†å™¨
  â™»ï¸ refactor(core): ç®€åŒ–é”™è¯¯å¤„ç†é€»è¾‘
  â™»ï¸ refactor(tasks): æå–å…¬å…±ä»»åŠ¡åŸºç±»
  ```

### 4. âš¡ perf - æ€§èƒ½ä¼˜åŒ–

- **æè¿°**: æå‡æ€§èƒ½çš„ä»£ç æ›´æ”¹
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: PATCH(ä¿®è®¢å· +1)
- **ç¤ºä¾‹**:
  ```
  âš¡ perf: ä¼˜åŒ– Redis è¿æ¥æ± æ€§èƒ½
  âš¡ perf(cache): å¢åŠ ç¼“å­˜å‘½ä¸­ç‡
  âš¡ perf(search): æ”¹è¿›æœç´¢æŸ¥è¯¢æ•ˆç‡
  ```

### 5. âœ… test - æµ‹è¯•ç›¸å…³

- **æè¿°**: æ·»åŠ æˆ–ä¿®æ­£æµ‹è¯•
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: PATCH(ä¿®è®¢å· +1)
- **ç¤ºä¾‹**:
  ```
  âœ… test: æ·»åŠ ç™»å½•æ¨¡å—å•å…ƒæµ‹è¯•
  âœ… test(integration): è¡¥å……äº¤æ˜“ä»»åŠ¡é›†æˆæµ‹è¯•
  âœ… test(core): ä¿®æ­£å¿ƒè·³ç®¡ç†å™¨æµ‹è¯•ç”¨ä¾‹
  ```

### 6. ğŸ”¨ build - æ„å»ºç³»ç»Ÿ

- **æè¿°**: å½±å“æ„å»ºç³»ç»Ÿæˆ–å¤–éƒ¨ä¾èµ–çš„æ›´æ”¹
- **å¸¸ç”¨ scope**: pip, docker, npm, uv
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: PATCH(ä¿®è®¢å· +1)
- **ç¤ºä¾‹**:
  ```
  ğŸ”¨ build: æ›´æ–°ä¾èµ–ç‰ˆæœ¬
  ğŸ”¨ build(docker): ä¼˜åŒ– Docker é•œåƒæ„å»º
  ğŸ”¨ build(uv): å‡çº§ uv åŒ…ç®¡ç†å™¨é…ç½®
  ```

### 7. ğŸ‘· ci - CI é…ç½®

- **æè¿°**: CI é…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„æ›´æ”¹
- **å¸¸ç”¨ scope**: GitLabCI, GitHub Actions
- **ç¤ºä¾‹**:
  ```
  ğŸ‘· ci: æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹
  ğŸ‘· ci(github): é…ç½® GitHub Actions å·¥ä½œæµ
  ğŸ‘· ci(pre-commit): æ›´æ–° pre-commit hooks
  ```

### 8. ğŸš€ break - ç ´åæ€§æ›´æ–°

- **æè¿°**: å¼•å…¥ä¸å…¼å®¹çš„ API æ›´æ”¹
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: MAJOR(ä¸»ç‰ˆæœ¬å· +1)
- **ç¤ºä¾‹**:
  ```
  ğŸš€ break: é‡æ„ gRPC æœåŠ¡æ¥å£
  ğŸš€ break(api): ç§»é™¤å·²åºŸå¼ƒçš„ API ç«¯ç‚¹
  ```

### 9. ğŸ’ bump - ç‰ˆæœ¬æ›´æ–°

- **æè¿°**: è‡ªåŠ¨åŒ–ç‰ˆæœ¬å·æå‡(ç”± commitizen è‡ªåŠ¨ç”Ÿæˆ)
- **æ ¼å¼**: `ğŸ’ bump: version $current_version â†’ $new_version`
- **ç¤ºä¾‹**:
  ```
  ğŸ’ bump: version 0.10.0 â†’ 0.10.1
  ```

## è¯­ä¹‰åŒ–ç‰ˆæœ¬æ˜ å°„

| æäº¤ç±»å‹    | ç‰ˆæœ¬å·å˜åŒ–    | ç¤ºä¾‹          |
| ----------- | ------------- | ------------- |
| ğŸš€ break    | MAJOR (x.0.0) | 1.2.3 â†’ 2.0.0 |
| âœ¨ feat     | MINOR (0.x.0) | 1.2.3 â†’ 1.3.0 |
| ğŸ› fix      | PATCH (0.0.x) | 1.2.3 â†’ 1.2.4 |
| â™»ï¸ refactor | PATCH (0.0.x) | 1.2.3 â†’ 1.2.4 |
| âš¡ perf     | PATCH (0.0.x) | 1.2.3 â†’ 1.2.4 |
| âœ… test     | PATCH (0.0.x) | 1.2.3 â†’ 1.2.4 |

## ä½¿ç”¨æ–¹æ³•

äº¤äº’å¼æç¤ºæµç¨‹:

1. **é€‰æ‹©æäº¤ç±»å‹**: ä» 7 ç§ç±»å‹ä¸­é€‰æ‹©(feat, fix, refactor, perf, test, build, ci)
2. **è¾“å…¥ç®€è¦æè¿°**: å¿…å¡«,æè¿°æœ¬æ¬¡æäº¤çš„æ ¸å¿ƒå†…å®¹
3. **è¾“å…¥ä¿®æ”¹èŒƒå›´**: å¯é€‰,å¦‚ `auth`, `config`, `trade` ç­‰
4. **è¾“å…¥è¯¦ç»†æè¿°**: å¯é€‰,è¡¥å……æ›´å¤šç»†èŠ‚
5. **è¾“å…¥å…³é—­çš„ issue**: å¯é€‰,å¦‚ `#123`, `#456`
6. **ç¡®è®¤æäº¤**: ç¡®è®¤åå®Œæˆæäº¤

### æ‰‹åŠ¨æäº¤ç¤ºä¾‹

```bash
# æ–°åŠŸèƒ½(å¸¦ scope)
git commit -m "âœ¨ feat(auth): æ·»åŠ  OAuth2 è®¤è¯æ”¯æŒ"

# Bug ä¿®å¤
git commit -m "ğŸ› fix: ä¿®å¤ä¼šè¯è¿‡æœŸå¯¼è‡´çš„ç™»å½•å¤±è´¥"

# é‡æ„(å¸¦è¯¦ç»†æè¿°)
git commit -m "â™»ï¸ refactor(core): é‡æ„å¼‚æ­¥ä»»åŠ¡ç®¡ç†å™¨

- æå–å…¬å…±åŸºç±» BaseTask
- ç®€åŒ–é”™è¯¯å¤„ç†é€»è¾‘
- ç»Ÿä¸€å¿ƒè·³ç®¡ç†æ¥å£
"

# æ€§èƒ½ä¼˜åŒ–
git commit -m "âš¡ perf(redis): ä¼˜åŒ–è¿æ¥æ± é…ç½®,æå‡ 30% æ€§èƒ½"

# æµ‹è¯•
git commit -m "âœ… test(integration): è¡¥å……äº¤æ˜“æ¨¡å—é›†æˆæµ‹è¯•"

# æ„å»ºç³»ç»Ÿ
git commit -m "ğŸ”¨ build(docker): ä¼˜åŒ–é•œåƒæ„å»ºæµç¨‹,å‡å°‘ 50% æ„å»ºæ—¶é—´"

# CI é…ç½®
git commit -m "ğŸ‘· ci(pre-commit): æ·»åŠ  mypy ç±»å‹æ£€æŸ¥ hook"
```

## Scope å‘½åè§„èŒƒ

Scope ä½¿ç”¨å°å†™å­—æ¯,ä»…å…è®¸å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦:

### å¸¸ç”¨ Scope ç¤ºä¾‹

```
auth          # è®¤è¯ç›¸å…³
config        # é…ç½®ç›¸å…³
core          # æ ¸å¿ƒæ¨¡å—
tasks         # ä»»åŠ¡æ¨¡å—
trade         # äº¤æ˜“ç›¸å…³
transfer      # è½¬è´¦ç›¸å…³
login         # ç™»å½•ç›¸å…³
session       # ä¼šè¯ç®¡ç†
redis         # Redis ç›¸å…³
grpc          # gRPC ç›¸å…³
api           # API ç›¸å…³
utils         # å·¥å…·å‡½æ•°
tests         # æµ‹è¯•ç›¸å…³
docker        # Docker ç›¸å…³
docs          # æ–‡æ¡£ç›¸å…³
```

### Scope æ­£åˆ™è¦æ±‚

```regex
[a-z][a-z0-9_-]*
```

- å¿…é¡»ä»¥å°å†™å­—æ¯å¼€å¤´
- åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦

## å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹ 1: å¸¦ scope çš„æ–°åŠŸèƒ½

```
âœ¨ feat(trade): å®ç°è‡ªåŠ¨ä¹°å…¥ç­–ç•¥

æ·»åŠ åŸºäºå¸‚åœºä»·æ ¼æ³¢åŠ¨çš„è‡ªåŠ¨ä¹°å…¥é€»è¾‘:
- ç›‘æ§ç›®æ ‡çƒå‘˜ä»·æ ¼
- å½“ä»·æ ¼ä½äºé˜ˆå€¼æ—¶è‡ªåŠ¨ä¸‹å•
- æ”¯æŒæ‰¹é‡è´­ä¹°å’Œå•æ¬¡è´­ä¹°æ¨¡å¼
- é›†æˆé£é™©æ§åˆ¶æœºåˆ¶

Closes #123
```

### ç¤ºä¾‹ 2: ç®€å•çš„ Bug ä¿®å¤

```
ğŸ› fix(session): å¤„ç†ä¼šè¯è¿‡æœŸå¼‚å¸¸
```

### ç¤ºä¾‹ 3: å¤æ‚çš„é‡æ„

```
â™»ï¸ refactor(core): é‡æ„ä»»åŠ¡æ³¨å†Œè¡¨å®ç°

åŸæœ‰å®ç°å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜,æœ¬æ¬¡é‡æ„:
1. ä½¿ç”¨ asyncio.Lock ä¿è¯åŸå­æ€§æ“ä½œ
2. ç®€åŒ– get_or_create æ¥å£
3. æ·»åŠ ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
4. ä¼˜åŒ–å†…å­˜å ç”¨(å‡å°‘ 40%)

Breaking Change: ç§»é™¤äº†å·²åºŸå¼ƒçš„ register_task æ–¹æ³•
```

### ç¤ºä¾‹ 4: æ€§èƒ½ä¼˜åŒ–

```
âš¡ perf(redis): ä¼˜åŒ–è¿æ¥æ± é…ç½®

- å¢åŠ æœ€å¤§è¿æ¥æ•°è‡³ 100
- å¯ç”¨è¿æ¥é¢„çƒ­æœºåˆ¶
- è°ƒæ•´è¶…æ—¶å‚æ•°
- æ€§èƒ½æå‡ 30%

åŸºå‡†æµ‹è¯•ç»“æœè§ docs/benchmarks/redis-pool-v2.md
```

## æ³¨æ„äº‹é¡¹

1. **Emoji å¿…é¡»åŒ¹é…**: ç¡®ä¿ emoji ä¸ type ä¸€è‡´
2. **Subject ç®€æ´æ˜äº†**: æ§åˆ¶åœ¨ 50 å­—ç¬¦ä»¥å†…
3. **ä½¿ç”¨ç°åœ¨æ—¶æ€**: "æ·»åŠ åŠŸèƒ½" è€Œé "å·²æ·»åŠ åŠŸèƒ½"
4. **é¦–å­—æ¯å°å†™**: subject ä¸è¦å¤§å†™å¼€å¤´(é™¤éæ˜¯ä¸“æœ‰åè¯)
5. **ä¸è¦å¥å·ç»“å°¾**: subject æœ«å°¾ä¸åŠ å¥å·
6. **Body è¯¦ç»†æè¿°**: è¯´æ˜"ä¸ºä»€ä¹ˆ"è€Œé"åšäº†ä»€ä¹ˆ"
7. **Footer å…³è” issue**: ä½¿ç”¨ `Closes #123` æˆ– `Fixes #456`

## å¸¸è§é”™è¯¯

### âŒ é”™è¯¯ç¤ºä¾‹

```bash
# ç¼ºå°‘ emoji
git commit -m "feat: add login"

# Type ä¸ emoji ä¸åŒ¹é…
git commit -m "âœ¨ fix: bug fix"

# Scope åŒ…å«å¤§å†™å­—æ¯
git commit -m "âœ¨ feat(Auth): add feature"

# Subject é¦–å­—æ¯å¤§å†™
git commit -m "âœ¨ feat: Add new feature"

# Subject ä»¥å¥å·ç»“å°¾
git commit -m "ğŸ› fix: fix bug."
```

### âœ… æ­£ç¡®ç¤ºä¾‹

```bash
git commit -m "âœ¨ feat: add login"
git commit -m "ğŸ› fix: fix authentication bug"
git commit -m "âœ¨ feat(auth): implement OAuth2"
git commit -m "â™»ï¸ refactor: simplify error handling"
```

## å‚è€ƒèµ„æº

- **Conventional Commits è§„èŒƒ**: https://www.conventionalcommits.org/
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬ (SemVer)**: https://semver.org/lang/zh-CN/
